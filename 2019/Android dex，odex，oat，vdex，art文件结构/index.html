<!doctype html>



  


<html class="theme-next pisces use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="PackageManagerService,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="在installd守护进程中有提到dexopt的操作，最后执行的操作是 run_dex2oat。本文将对dex和oat文件格式进行介绍分析。 1234567891011121314151617181920run_dex2oat(input_fd.get(),                 out_oat_fd.get(),                 in_vdex_fd.get(),">
<meta name="keywords" content="PackageManagerService">
<meta property="og:type" content="article">
<meta property="og:title" content="Android dex，odex，oat，vdex，art文件结构">
<meta property="og:url" content="http://zproo.github.io/2019/Android dex，odex，oat，vdex，art文件结构/index.html">
<meta property="og:site_name" content="Skytoby">
<meta property="og:description" content="在installd守护进程中有提到dexopt的操作，最后执行的操作是 run_dex2oat。本文将对dex和oat文件格式进行介绍分析。 1234567891011121314151617181920run_dex2oat(input_fd.get(),                 out_oat_fd.get(),                 in_vdex_fd.get(),">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/dex.png">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/010%20Editor.PNG">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/odex.png">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/oat.png">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/backtrace.png">
<meta property="og:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/dex-oat.png">
<meta property="og:updated_time" content="2019-08-14T09:09:57.985Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android dex，odex，oat，vdex，art文件结构">
<meta name="twitter:description" content="在installd守护进程中有提到dexopt的操作，最后执行的操作是 run_dex2oat。本文将对dex和oat文件格式进行介绍分析。 1234567891011121314151617181920run_dex2oat(input_fd.get(),                 out_oat_fd.get(),                 in_vdex_fd.get(),">
<meta name="twitter:image" content="http://zproo.github.io/2019/Android%20dex，odex，oat，vdex，art文件结构/dex.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://zproo.github.io/2019/Android dex，odex，oat，vdex，art文件结构/">

  <title> Android dex，odex，oat，vdex，art文件结构 | Skytoby </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>
    
    <header id="header_post" class="header" itemscope="" itemtype="http://schema.org/WPHeader" style="background-image: url('http://ortur5wom.bkt.clouddn.com/home_bg.jpg');">
      <div class="header-inner-post"><a class="site-home" href="/">Skytoby</a>

<div class="site-meta ">
  
  
  
    <div class="site-meta-headline">
      <a>
        <img class="custom-logo-image" src="/images/logo.png" style="width: 50px" alt="Skytoby">
      </a>
    </div>
  

  
  
  
  
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
           <li class="menu-item menu-item-关于">
             <a href="/about" rel="section">
               
               
               关于
             </a>
           </li>
        
      
        
        
        
           <li class="menu-item menu-item-目录">
             <a href="/archives" rel="section">
               
               
               目录
             </a>
           </li>
        
      
        
        
        
           <li class="menu-item menu-item-首页">
             <a href="/" rel="section">
               
               
               首页
             </a>
           </li>
        
      

      
    </ul>
  

  
</nav> </div>
      <div class="header-post"> 
  <div class="post-header">
      <div class="tags">
      
        <a href="/tags/PackageManagerService/" rel="tag" title="PackageManagerService">PackageManagerService</a>
      
      </div>
      <h1>Android dex，odex，oat，vdex，art文件结构</h1>
      <h2 class="subtitle"></h2>
      <div class="post-time">
        <span class="post-meta-item-text">Posted on </span>
        <time itemprop="dateCreated" datetime="2019-05-20T21:18:23+08:00" content="2019-05-20" title="2019-05-20 21:18:23">
          2019-05-20
        </time>
      </div>
  </div>
 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android dex，odex，oat，vdex，art文件结构
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2019-05-20T21:18:23+08:00" content="2019-05-20">
              2019-05-20
            </time>
          </span>

          

          <!-- 
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2019/Android dex，odex，oat，vdex，art文件结构/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/Android dex，odex，oat，vdex，art文件结构/" itemprop="commentsCount"></span>
                </a>
              </span>
            
           -->

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在installd守护进程中有提到dexopt的操作，最后执行的操作是 run_dex2oat。本文将对dex和oat文件格式进行介绍分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">run_dex2oat(input_fd.get(),</span><br><span class="line">                 out_oat_fd.get(),</span><br><span class="line">                 in_vdex_fd.get(),</span><br><span class="line">                 out_vdex_fd.get(),</span><br><span class="line">                 image_fd.get(),</span><br><span class="line">                 dex_path,</span><br><span class="line">                 out_oat_path,</span><br><span class="line">                 swap_fd.get(),</span><br><span class="line">                 instruction_set,</span><br><span class="line">                 compiler_filter,</span><br><span class="line">                 debuggable,</span><br><span class="line">                 boot_complete,</span><br><span class="line">                 background_job_compile,</span><br><span class="line">                 reference_profile_fd.get(),</span><br><span class="line">                 class_loader_context,</span><br><span class="line">                 target_sdk_version,</span><br><span class="line">                 enable_hidden_api_checks,</span><br><span class="line">                 generate_compact_dex,</span><br><span class="line">                 dex_metadata_fd.get(),</span><br><span class="line">                 compilation_reason);</span><br></pre></td></tr></table></figure>
<h2 id="一、Android-Dex文件"><a href="#一、Android-Dex文件" class="headerlink" title="一、Android Dex文件"></a>一、Android Dex文件</h2><p>Dex是Android平台上(Dalvik虚拟机)的可执行文件, 相当于Windows平台中的exe文件, 每个Apk安装包中都有dex文件, 里面包含了该app的所有源码, 通过反编译工具可以获取到相应的java源码。</p>
<p>在Android平台上，当java程序编译成class后，使用dx工具将所有的class文件整合到一个dex文件，目的是其中各个类能够共享数据，在一定程度上降低了冗余，同时也是文件结构更加经凑，dex文件是传统jar文件大小的50%左右。</p>
<h3 id="1-1-整体结构"><a href="#1-1-整体结构" class="headerlink" title="1.1 整体结构"></a>1.1 整体结构</h3><p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/dex.png" alt=""></p>
<h3 id="1-2-详细描述"><a href="#1-2-详细描述" class="headerlink" title="1.2 详细描述"></a>1.2 详细描述</h3><table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>格式</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>header</td>
<td>header_item</td>
<td>标头</td>
</tr>
<tr>
<td>string_ids</td>
<td>string_id_item[]</td>
<td>字符串标识符列表。这些是此文件使用的所有字符串的标识符，用于内部命名（例如类型描述符）或用作代码引用的常量对象。此列表必须使用 UTF-16 代码点值按字符串内容进行排序（不采用语言区域敏感方式），且不得包含任何重复条目。</td>
</tr>
<tr>
<td>type_ids</td>
<td>type_id_item[]</td>
<td>类型标识符列表。这些是此文件引用的所有类型（类、数组或原始类型）的标识符（无论文件中是否已定义）。此列表必须按 <code>string_id</code> 索引进行排序，且不得包含任何重复条目。</td>
</tr>
<tr>
<td>proto_ids</td>
<td>proto_id_item[]</td>
<td>方法原型标识符列表。这些是此文件引用的所有原型的标识符。此列表必须按返回类型（按 <code>type_id</code> 索引排序）主要顺序进行排序，然后按参数列表（按 <code>type_id</code> 索引排序的各个参数，采用字典排序方法）进行排序。该列表不得包含任何重复条目。</td>
</tr>
<tr>
<td>field_ids</td>
<td>field_id_item[]</td>
<td>字段标识符列表。这些是此文件引用的所有字段的标识符（无论文件中是否已定义）。此列表必须进行排序，其中定义类型（按 <code>type_id</code> 索引排序）是主要顺序，字段名称（按 <code>string_id</code> 索引排序）是中间顺序，而类型（按 <code>type_id</code> 索引排序）是次要顺序。该列表不得包含任何重复条目。</td>
</tr>
<tr>
<td>method_ids</td>
<td>method_id_item[]</td>
<td>方法标识符列表。这些是此文件引用的所有方法的标识符（无论文件中是否已定义）。此列表必须进行排序，其中定义类型（按 <code>type_id</code> 索引排序）是主要顺序，方法名称（按 <code>string_id</code> 索引排序）是中间顺序，而方法原型（按 <code>proto_id</code> 索引排序）是次要顺序。该列表不得包含任何重复条目。</td>
</tr>
<tr>
<td>class_defs</td>
<td>class_def_item[]</td>
<td>类定义列表。这些类必须进行排序，以便所指定类的超类和已实现的接口比引用类更早出现在该列表中。此外，对于在该列表中多次出现的同名类，其定义是无效的。</td>
</tr>
<tr>
<td>call_site_ids</td>
<td>call_site_id_item[]</td>
<td>调用站点标识符列表。这些是此文件引用的所有调用站点的标识符（无论文件中是否已定义）。此列表必须按 <code>call_site_off</code>的升序进行排序。</td>
</tr>
<tr>
<td>method_handles</td>
<td>method_handle_item[]</td>
<td>方法句柄列表。此文件引用的所有方法句柄的列表（无论文件中是否已定义）。此列表未进行排序，而且可能包含将在逻辑上对应于不同方法句柄实例的重复项。</td>
</tr>
<tr>
<td>data</td>
<td>ubyte[]</td>
<td>数据区，包含上面所列表格的所有支持数据。不同的项有不同的对齐要求；如有必要，则在每个项之前插入填充字节，以实现所需的对齐效果。</td>
</tr>
<tr>
<td>link_data</td>
<td>ubyte[]</td>
<td>静态链接文件中使用的数据。本文档尚未指定本区段中数据的格式。此区段在未链接文件中为空，而运行时实现可能会在适当的情况下使用这些数据。</td>
</tr>
</tbody>
</table>
<h3 id="1-3-用010editor查看dex文件"><a href="#1-3-用010editor查看dex文件" class="headerlink" title="1.3 用010editor查看dex文件"></a>1.3 用010editor查看dex文件</h3><p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/010 Editor.PNG" alt=""></p>
<p>查看每项的定义即情况，具体可以参考<a href="https://source.android.com/devices/tech/dalvik/dex-format" target="_blank" rel="noopener">https://source.android.com/devices/tech/dalvik/dex-format</a></p>
<p>也可以查看dex相关的code进行结构的梳理：</p>
<p><a href="https://android.googlesource.com/platform/dalvik/+/master/dx/src/com/android/dx/dex/file/DexFile.java" target="_blank" rel="noopener">https://android.googlesource.com/platform/dalvik/+/master/dx/src/com/android/dx/dex/file/DexFile.java</a></p>
<p>总之来说，dex是将apk中使用到的class文件信息集合在一起的文件，其中也包含了很多jar包中的类。<br> dex文件是对class文件中的各种函数表、变量表等进行优化过的，整体大小要小于class文件总和。</p>
<h2 id="二-Android-Odex，Oat，Vdex-art文件"><a href="#二-Android-Odex，Oat，Vdex-art文件" class="headerlink" title="二. Android Odex，Oat，Vdex , art文件"></a>二. Android Odex，Oat，Vdex , art文件</h2><h3 id="2-1-odex文件概述（-5-0之前-）"><a href="#2-1-odex文件概述（-5-0之前-）" class="headerlink" title="2.1 odex文件概述（ 5.0之前 ）"></a>2.1 odex文件概述（ 5.0之前 ）</h3><p>全名Optimized DEX，即优化过的DEX。<br> Apk在安装(installer)时，就会进行验证和优化，目的是为了校验代码合法性及优化代码执行速度，验证和优化后，会产生ODEX文件，运行Apk的时候，直接加载ODEX，避免重复验证和优化，加快了Apk的响应时间。</p>
<p>注意：优化过程会根据不同设备上Dalvik虚拟机的版本、Framework库的不同等因素而不同。在一台设备上被优化过的ODEX文件，拷贝到另一台设备上不一定能够运行。</p>
<p>ODEX格式及生成过程：<a href="https://www.jianshu.com/p/242abfb7eb7f" target="_blank" rel="noopener">https://www.jianshu.com/p/242abfb7eb7f</a></p>
<p>整体结构盗图如下：</p>
<p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/odex.png" alt=""></p>
<h3 id="2-2-oat文件（5-0及5-0之后）"><a href="#2-2-oat文件（5-0及5-0之后）" class="headerlink" title="2.2. oat文件（5.0及5.0之后）"></a>2.2. oat文件（5.0及5.0之后）</h3><p>参考博客：<br> Android运行时ART加载OAT文件的过程分析：[<a href="https://blog.csdn.net/luoshengyang/article/details/39307813]" target="_blank" rel="noopener">https://blog.csdn.net/luoshengyang/article/details/39307813]</a><br> oat格式(1)：[<a href="https://shaomi.github.io/2017/08/18/oat%E6%A0%BC%E5%BC%8F/]" target="_blank" rel="noopener">https://shaomi.github.io/2017/08/18/oat%E6%A0%BC%E5%BC%8F/]</a><br> 从Android运行时出发，打造我们的脱壳神器：<br> [<a href="https://www.feiworks.com/wy/drops_html/%E4%BB%8EAndroid%E8%BF%90%E8%A1%8C%E6%97%B6%E5%87%BA%E5%8F%91%EF%BC%8C%E6%89%93%E9%80%A0%E6%88%91%E4%BB%AC%E7%9A%84%E8%84%B1%E5%A3%B3%E7%A5%9E%E5%99%A8.html]" target="_blank" rel="noopener">https://www.feiworks.com/wy/drops_html/%E4%BB%8EAndroid%E8%BF%90%E8%A1%8C%E6%97%B6%E5%87%BA%E5%8F%91%EF%BC%8C%E6%89%93%E9%80%A0%E6%88%91%E4%BB%AC%E7%9A%84%E8%84%B1%E5%A3%B3%E7%A5%9E%E5%99%A8.html]</a></p>
<h4 id="2-2-1-oat文件概述"><a href="#2-2-1-oat文件概述" class="headerlink" title="2.2.1 oat文件概述"></a>2.2.1 oat文件概述</h4><p>oat 文件是 ART 运行的文件，是一种ELF格式的二进制可运行文件，包含 DEX 文件和编译出的本地机器指令文件。因为 oat 文件包含 DEX 文件，因此比 ODEX 文件占用空间更大。</p>
<p>由于其在安装时打包在里面的classes.dex文件会被工具dex2oat翻译成本地机器指令，最终得到一个ELF格式的OAT文件，ART 加载 OAT 文件后不需要经过处理就可以直接运行，它没有了从字节码装换成机器码的过程，因此运行速度更快。</p>
<p>查看三方应用的安装包如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ== # ls -la</span><br><span class="line">total 1564</span><br><span class="line">drwxr-xr-x 4 system system     4096 2018-01-01 10:42 .</span><br><span class="line">drwxrwx--x 5 system system     4096 2018-01-02 09:30 ..</span><br><span class="line">-rw-r--r-- 1 system system  1582454 2018-01-01 10:42 base.apk</span><br><span class="line">drwxr-xr-x 2 system system     4096 2018-01-01 10:42 lib</span><br><span class="line">drwxrwx--x 3 system install    4096 2018-01-01 10:42 oat</span><br><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ== # cd oat</span><br><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ==/oat # ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxrwx--x 3 system install 4096 2018-01-01 10:42 .</span><br><span class="line">drwxr-xr-x 4 system system  4096 2018-01-01 10:42 ..</span><br><span class="line">drwxrwx--x 2 system install 4096 2018-01-01 12:06 arm64</span><br><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ==/oat # cd arm64</span><br><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ==/oat/arm64 # ls -la</span><br><span class="line">total 2192</span><br><span class="line">drwxrwx--x 2 system install    4096 2018-01-01 12:06 .</span><br><span class="line">drwxrwx--x 3 system install    4096 2018-01-01 10:42 ..</span><br><span class="line">-rw-r----- 1 system all_a71   32768 2018-01-01 12:06 base.art</span><br><span class="line">-rw-r----- 1 system all_a71   45696 2018-01-01 10:42 base.odex</span><br><span class="line">-rw-r----- 1 system all_a71 2152664 2018-01-01 12:06 base.vdex</span><br><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ==/oat/arm64 #</span><br></pre></td></tr></table></figure>
<p>怎么还是odex，这个art文件是啥，这个vdex又是啥，</p>
<p>官方回答：<a href="https://source.android.com/devices/tech/dalvik/configure" target="_blank" rel="noopener">https://source.android.com/devices/tech/dalvik/configure</a> .</p>
<p>vdex：其中包含 APK 的未压缩 DEX 代码，另外还有一些旨在加快验证速度的元数据。 </p>
<p>odex：其中包含 APK 中已经过 AOT 编译的方法代码。 </p>
<p>art (optional)：其中包含 APK 中列出的某些字符串和类的 ART 内部表示，用于加快应用启动速度。</p>
<p>使用file命令查看这个base.odex</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PNC:/data/app/com.android.mywebviewtest-KtextonrnkHCwJ3LnA-5ZQ==/oat/arm64 # file base.odex</span><br><span class="line">base.odex: ELF shared object, 64-bit LSB arm64, stripped</span><br></pre></td></tr></table></figure>
<p><strong>看到这个base.odex文件是ELF格式封装的，所以这里的odex其实就是oat文件，只是还是叫odex后缀。</strong></p>
<p>查看系统自带应用，比如system/priv-app/，system/app/中的apk，最终oat文件存放在/data/dalvik-cache/ 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">PNC:/data/dalvik-cache/arm64 #</span><br><span class="line">130|PNC:/data/dalvik-cache/arm64 # ls -la</span><br><span class="line">total 132060</span><br><span class="line">drwx--x--x 2 root   root         28672 2018-01-01 12:07 .</span><br><span class="line">drwxrwx--x 4 root   root          4096 2018-01-01 08:01 ..</span><br><span class="line">-rw-r----- 1 system system        8192 2018-01-01 12:06 system@app@AntHalService@AntHalService.apk@classes.art</span><br><span class="line">-rw-r----- 1 system system       21120 2009-01-01 00:00 system@app@AntHalService@AntHalService.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system system       22850 2018-01-01 12:06 system@app@AntHalService@AntHalService.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system radio        12288 2018-01-01 12:04 system@app@AutoRegistration@AutoRegistration.apk@classes.art</span><br><span class="line">-rw-r----- 1 system radio        17024 2009-01-01 00:00 system@app@AutoRegistration@AutoRegistration.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system radio        60522 2018-01-01 12:04 system@app@AutoRegistration@AutoRegistration.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system all_a32       8192 2018-01-01 12:05 system@app@BasicDreams@BasicDreams.apk@classes.art</span><br><span class="line">-rw-r----- 1 system all_a32      17024 2009-01-01 00:00 system@app@BasicDreams@BasicDreams.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system all_a32      15952 2018-01-01 12:05 system@app@BasicDreams@BasicDreams.apk@classes.vdex</span><br><span class="line">-rw-r--r-- 1 system bluetooth 12911232 2009-01-01 00:00 system@app@Bluetooth@Bluetooth.apk@classes.dex</span><br><span class="line">-rw-r--r-- 1 system bluetooth  6188408 2018-01-01 12:07 system@app@Bluetooth@Bluetooth.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system bluetooth    16384 2018-01-01 12:05 system@app@BluetoothExt@BluetoothExt.apk@classes.art</span><br><span class="line">-rw-r----- 1 system bluetooth    21120 2009-01-01 00:00 system@app@BluetoothExt@BluetoothExt.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system bluetooth   288680 2018-01-01 12:05 system@app@BluetoothExt@BluetoothExt.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system all_a33       8192 2018-01-01 12:07 system@app@BluetoothMidiService@BluetoothMidiService.apk@classes.art</span><br><span class="line">-rw-r----- 1 system all_a33      17024 2009-01-01 00:00 system@app@BluetoothMidiService@BluetoothMidiService.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system all_a33      19518 2018-01-01 12:07 system@app@BluetoothMidiService@BluetoothMidiService.apk@classes.vde</span><br><span class="line">-rw-r----- 1 system all_a34       8192 2018-01-01 12:06 system@app@BookmarkProvider@BookmarkProvider.apk@classes.art</span><br><span class="line">-rw-r----- 1 system all_a34      17024 2009-01-01 00:00 system@app@BookmarkProvider@BookmarkProvider.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system all_a34       1580 2018-01-01 12:06 system@app@BookmarkProvider@BookmarkProvider.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system system       32768 2018-01-01 12:04 system@app@CITTest@CITTest.apk@classes.art</span><br><span class="line">-rw-r----- 1 system system       74368 2009-01-01 00:00 system@app@CITTest@CITTest.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system system     4172460 2018-01-01 12:04 system@app@CITTest@CITTest.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system all_a35      24576 2018-01-01 12:05 system@app@Calendar@Calendar.apk@classes.art</span><br><span class="line">-rw-r----- 1 system all_a35      29312 2009-01-01 00:00 system@app@Calendar@Calendar.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system all_a35    1122530 2018-01-01 12:05 system@app@Calendar@Calendar.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system system        8192 2018-01-01 12:04 system@app@CallEnhancement@CallEnhancement.apk@classes.art</span><br><span class="line">-rw-r----- 1 system system       17024 2009-01-01 00:00 system@app@CallEnhancement@CallEnhancement.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system system       36950 2018-01-01 12:04 system@app@CallEnhancement@CallEnhancement.apk@classes.vdex</span><br><span class="line">-rw-r----- 1 system radio         8192 2018-01-01 12:05 system@app@CallFeaturesSetting@CallFeaturesSetting.apk@classes.art</span><br><span class="line">-rw-r----- 1 system radio        17024 2009-01-01 00:00 system@app@CallFeaturesSetting@CallFeaturesSetting.apk@classes.dex</span><br><span class="line">-rw-r----- 1 system radio        52222 2018-01-01 12:05 system@app@CallFeaturesSetting@CallFeaturesSetting.apk@classes.vdex</span><br></pre></td></tr></table></figure>
<p>这里的dex文件也是oat文件，只是以dex为后缀命名，/data/dalvik-cache/ 下也有以oat为后缀命名的oat文件，通过如上的file命令就可以看出来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PNC:/data/dalvik-cache/arm64 #</span><br><span class="line">130|PNC:/data/dalvik-cache/arm64 # file system@app@BluetoothExt@BluetoothExt.apk@classes.dex</span><br><span class="line">system@app@BluetoothExt@BluetoothExt.apk@classes.dex: ELF shared object, 64-bit LSB arm64, stripped</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-readelf-查看oat文件结构"><a href="#2-2-2-readelf-查看oat文件结构" class="headerlink" title="2.2.2 readelf 查看oat文件结构"></a>2.2.2 readelf 查看oat文件结构</h4><p>安装包中的oat文件由于是elf格式封装，可以使用readelf命令查看文件信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 01 01 01 03 00 00 00 00 00 00 00 00 </span><br><span class="line">  Class:                             ELF32</span><br><span class="line">  Data:                              2&apos;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - GNU</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              DYN (Shared object file)</span><br><span class="line">  Machine:                           ARM</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  Entry point address:               0x0</span><br><span class="line">  Start of program headers:          52 (bytes into file)</span><br><span class="line">  Start of section headers:          4261112 (bytes into file)</span><br><span class="line">  Flags:                             0x5000000, Version5 EABI</span><br><span class="line">  Size of this header:               52 (bytes)</span><br><span class="line">  Size of program headers:           32 (bytes)</span><br><span class="line">  Number of program headers:         8</span><br><span class="line">  Size of section headers:           40 (bytes)</span><br><span class="line">  Number of section headers:         11</span><br><span class="line">  Section header string table index: 10</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .rodata           PROGBITS        00001000 001000 1c9000 00   A  0   0 4096</span><br><span class="line">  [ 2] .text             PROGBITS        001ca000 1ca000 22f98c 00  AX  0   0 4096</span><br><span class="line">  [ 3] .bss              NOBITS          003fa000 000000 0079b8 00   A  0   0 4096</span><br><span class="line">  [ 4] .dex              NOBITS          00402000 000000 40dacf4 00   A  0   0 4096</span><br><span class="line">  [ 5] .dynstr           STRTAB          044dd000 3fa000 00006d 00   A  0   0 4096</span><br><span class="line">  [ 6] .dynsym           DYNSYM          044dd070 3fa070 0000a0 10   A  5   1  4</span><br><span class="line">  [ 7] .hash             HASH            044dd110 3fa110 000034 04   A  6   0  4</span><br><span class="line">  [ 8] .dynamic          DYNAMIC         044de000 3fb000 000038 08   A  5   0 4096</span><br><span class="line">  [ 9] .gnu_debugdata    PROGBITS        00000000 3fc000 0144a4 00      0   0 4096</span><br><span class="line">  [10] .shstrtab         STRTAB          00000000 4104a4 000051 00      0   0  1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings)</span><br><span class="line">  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)</span><br><span class="line">  O (extra OS processing required) o (OS specific), p (processor specific)</span><br><span class="line"></span><br><span class="line">There are no section groups in this file.</span><br><span class="line"></span><br><span class="line">Program Headers:</span><br><span class="line">  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align</span><br><span class="line">  PHDR           0x000034 0x00000034 0x00000034 0x00100 0x00100 R   0x4</span><br><span class="line">  LOAD           0x000000 0x00000000 0x00000000 0x1ca000 0x1ca000 R   0x1000</span><br><span class="line">  LOAD           0x1ca000 0x001ca000 0x001ca000 0x22f98c 0x22f98c R E 0x1000</span><br><span class="line">  LOAD           0x000000 0x003fa000 0x003fa000 0x00000 0x079b8 RW  0x1000</span><br><span class="line">  LOAD           0x000000 0x00402000 0x00402000 0x00000 0x40dacf4 R   0x1000</span><br><span class="line">  LOAD           0x3fa000 0x044dd000 0x044dd000 0x00144 0x00144 R   0x1000</span><br><span class="line">  LOAD           0x3fb000 0x044de000 0x044de000 0x00038 0x00038 RW  0x1000</span><br><span class="line">  DYNAMIC        0x3fb000 0x044de000 0x044de000 0x00038 0x00038 RW  0x1000</span><br><span class="line"></span><br><span class="line"> Section to Segment mapping:</span><br><span class="line">  Segment Sections...</span><br><span class="line">   00     </span><br><span class="line">   01     .rodata </span><br><span class="line">   02     .text </span><br><span class="line">   03     .bss </span><br><span class="line">   04     .dex </span><br><span class="line">   05     .dynstr .dynsym .hash </span><br><span class="line">   06     .dynamic </span><br><span class="line">   07     .dynamic </span><br><span class="line"></span><br><span class="line">Dynamic section at offset 0x3fb000 contains 7 entries:</span><br><span class="line">  Tag        Type                         Name/Value</span><br><span class="line"> 0x00000004 (HASH)                       0x44dd110</span><br><span class="line"> 0x00000005 (STRTAB)                     0x44dd000</span><br><span class="line"> 0x00000006 (SYMTAB)                     0x44dd070</span><br><span class="line"> 0x0000000b (SYMENT)                     16 (bytes)</span><br><span class="line"> 0x0000000a (STRSZ)                      109 (bytes)</span><br><span class="line"> 0x0000000e (SONAME)                     Library soname: [base.odex]</span><br><span class="line"> 0x00000000 (NULL)                       0x0</span><br><span class="line"></span><br><span class="line">There are no relocations in this file.</span><br><span class="line"></span><br><span class="line">There are no unwind sections in this file.</span><br><span class="line"></span><br><span class="line">Symbol table &apos;.dynsym&apos; contains 10 entries:</span><br><span class="line">   Num:    Value  Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 00000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 00001000 0x1c9000 OBJECT  GLOBAL DEFAULT    1 oatdata</span><br><span class="line">     2: 001ca000     0 OBJECT  GLOBAL DEFAULT    2 oatexec</span><br><span class="line">     3: 003f9988     4 OBJECT  GLOBAL DEFAULT    2 oatlastword</span><br><span class="line">     4: 003fa000  8456 OBJECT  GLOBAL DEFAULT    3 oatbss</span><br><span class="line">     5: 003fa000  8456 OBJECT  GLOBAL DEFAULT    3 oatbssmethods</span><br><span class="line">     6: 003fc108 22704 OBJECT  GLOBAL DEFAULT    3 oatbssroots</span><br><span class="line">     7: 004019b4     4 OBJECT  GLOBAL DEFAULT    3 oatbsslastword</span><br><span class="line">     8: 00402000     0 OBJECT  GLOBAL DEFAULT    4 oatdex</span><br><span class="line">     9: 044dccf0     4 OBJECT  GLOBAL DEFAULT    4 oatdexlastword</span><br><span class="line"></span><br><span class="line">Histogram for bucket list length (total of 1 buckets):</span><br><span class="line"> Length  Number     % of total  Coverage</span><br><span class="line">      0  1          (100.0%)</span><br><span class="line"></span><br><span class="line">No version information found in this file.</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-oat文件结构大致如图"><a href="#2-2-3-oat文件结构大致如图" class="headerlink" title="2.2.3 oat文件结构大致如图"></a>2.2.3 oat文件结构大致如图</h4><p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/oat.png" alt=""></p>
<p>如上图应知：</p>
<p>1.oat文件中有完整的dex文件，oat data section 中对应着真正的oat文件，即 外层是elf 包含着 oat，oat 包含着dex<br>2.符号oatdata和oatlastword分别指定了oat文件在elf文件中的头和尾的位置，符号oatexec指向可执行段的位置；<br>3.oat文件有自己的头和格式，并且其内部包含了一个完整的dex文件。<br>4.oat其实就是一个Elf格式的二进制文件，跟Elf文件不同的是它内部多了oatdata、oatexec、oatlastword几个符号。其中oatdata的起始位置相对文件头固定为0x1000字节，而我们通过oatdump反编译的时候出来的地址是从0x1000开始的，所以这也是为什么我们在backtrace中计算地址的时候最后要减去0x1000，才能去dump里面找对应的地址。</p>
<p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/backtrace.png" alt=""></p>
<p>oat文件格式如图所示，这里0x1000是oatdata相对于文件头的偏移，接着就是oatdata的大小，也就是oatdump中的executable_offset，这个值保存在Oat文件的OatHeader里面。然后就是oatexec段，也就是机器码。而进程运行过程中异常如果挂在oat文件中，那么其pc一定是在oatexec段内。</p>
<h3 id="2-3-art文件"><a href="#2-3-art文件" class="headerlink" title="2.3. art文件"></a>2.3. art文件</h3><p>看到上面有art文件，.art是一些类/filed/方法，app启动直接map到内存，从odex中拆分出来的,art文件主要为了加快应用的对“热代码”的加载与缓存</p>
<h3 id="2-4-vdex文件"><a href="#2-4-vdex文件" class="headerlink" title="2.4. vdex文件"></a>2.4. vdex文件</h3><p>google在android8.0新增加了vdex文件，其中包含 APK 的未压缩 DEX 代码，另外还有一些旨在加快验证速度的元数据。</p>
<p>VDEX 文件有助于提升软件更新的性能和用户体验。VDEX 文件会存储包含验证程序依赖项且经过预验证的 DEX 文件，以便 ART 在系统更新期间无需再次解压和验证 DEX 文件。无需执行任何操作，即可实现该功能。该功能默认处于启用状态。要停用该功能，请将 ART_ENABLE_VDEX 环境变量设为 false。</p>
<p>定义结构：art/runtime/vdex_file.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">34// VDEX files contain extracted DEX files. The VdexFile class maps the file to</span><br><span class="line">35// memory and provides tools for accessing its individual sections.</span><br><span class="line">36//</span><br><span class="line">37// File format:</span><br><span class="line">38//   VdexFile::VerifierDepsHeader    fixed-length header</span><br><span class="line">39//      Dex file checksums</span><br><span class="line">40//</span><br><span class="line">41//   Optionally:</span><br><span class="line">42//      VdexFile::DexSectionHeader   fixed-length header</span><br><span class="line">43//</span><br><span class="line">44//      quicken_table_off[0]  offset into QuickeningInfo section for offset table for DEX[0].</span><br><span class="line">45//      DEX[0]                array of the input DEX files, the bytecode may have been quickened.</span><br><span class="line">46//      quicken_table_off[1]</span><br><span class="line">47//      DEX[1]</span><br><span class="line">48//      ...</span><br><span class="line">49//      DEX[D]</span><br><span class="line">50//</span><br><span class="line">51//   VerifierDeps</span><br><span class="line">52//      uint8[D][]                 verification dependencies</span><br><span class="line">53//</span><br><span class="line">54//   Optionally:</span><br><span class="line">55//      QuickeningInfo</span><br><span class="line">56//        uint8[D][]                  quickening data</span><br><span class="line">57//        uint32[D][]                 quickening data offset tables</span><br></pre></td></tr></table></figure>
<h2 id="三-总结"><a href="#三-总结" class="headerlink" title="三. 总结"></a>三. 总结</h2><p><img src="/2019/Android dex，odex，oat，vdex，art文件结构/dex-oat.png" alt=""></p>
<h2 id="四-工具使用"><a href="#四-工具使用" class="headerlink" title="四.工具使用"></a>四.工具使用</h2><h3 id="4-1-dx-和-dexdump工具"><a href="#4-1-dx-和-dexdump工具" class="headerlink" title="4.1.dx 和 dexdump工具"></a>4.1.dx 和 dexdump工具</h3><p>在sdk目录：~/Android/Sdk/build-tools/ 下有dex 打包工具:dx </p>
<p>解析dex的工具：dexdump;</p>
<p>源码目录下prebuilts下也有该工具;</p>
<p>手机中也有该工具： system/bin/dexdump</p>
<h3 id="4-2-oatdump工具"><a href="#4-2-oatdump工具" class="headerlink" title="4.2. oatdump工具"></a>4.2. oatdump工具</h3><p>在手机中有该工具： /system/bin/oatdump，可以解析oat文件。</p>
<h3 id="4-3-objdump工具"><a href="#4-3-objdump工具" class="headerlink" title="4.3.objdump工具"></a>4.3.objdump工具</h3><p>对于android开发是源码下对应的arm-linux-androideabi-objdump而非电脑系统的objdump：</p>
<p>./prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9/bin/arm-linux-androideabi-objdump  -S ~/Documents/f3b/symbol/out/target/product/pyxis/symbols/vendor/lib/hw/camera.qcom.so | tee camera.qcom.asm<br> 用来反编译symbol文件为汇编指令用于问题定位。</p>
<h3 id="4-4-Vdex-Extractor工具"><a href="#4-4-Vdex-Extractor工具" class="headerlink" title="4.4. Vdex Extractor工具"></a>4.4. Vdex Extractor工具</h3><p>Vdex Extractor：从Vdex文件反编译和提取Android Dex字节码的工具：[<a href="https://www.freebuf.com/sectool/185881.html]" target="_blank" rel="noopener">https://www.freebuf.com/sectool/185881.html]</a></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>Android[art]-Android dex，odex，oat，vdex，art文件结构学习总结：<a href="https://www.jianshu.com/p/0f1b0bdd6e42Android" target="_blank" rel="noopener">https://www.jianshu.com/p/0f1b0bdd6e42Android</a> Dex文件格式(一)：[<a href="https://blog.csdn.net/p312011150/article/details/80501690]" target="_blank" rel="noopener">https://blog.csdn.net/p312011150/article/details/80501690]</a><br>dex文件解析(第三篇) ：[<a href="https://blog.csdn.net/tabactivity/article/details/78950379]" target="_blank" rel="noopener">https://blog.csdn.net/tabactivity/article/details/78950379]</a><br>Android安全–Dex文件格式详解：[<a href="https://www.cnblogs.com/kexing/p/8890162.html]" target="_blank" rel="noopener">https://www.cnblogs.com/kexing/p/8890162.html]</a><br>Dalvik和Art,JIT ,AOT, oat, dex, odex：[<a href="https://www.colabug.com/4516410.html]" target="_blank" rel="noopener">https://www.colabug.com/4516410.html]</a><br>官方文档：[<a href="https://source.android.com/devices/tech/dalvik/dex-format]" target="_blank" rel="noopener">https://source.android.com/devices/tech/dalvik/dex-format]</a></p>

      
    </div>


    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PackageManagerService/" rel="tag">#PackageManagerService</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/Android系统SystemServer启动（下）/" rel="next" title="Android系统SystemServer启动（下）">
                <i class="fa fa-chevron-left"></i> Android系统SystemServer启动（下）
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/fstrim/" rel="prev" title="fstrim解析">
                fstrim解析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Skytoby">
          <p class="site-author-name" itemprop="name">Skytoby</p>
          <p class="site-description motion-element" itemprop="description">现居深圳，毕业于电子科技大学 <br> 技术领域：Android、AI <br><br>座右铭：想法+行动+坚持</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/caoxiaoliang" target="_blank" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://me.csdn.net/cao861544325" target="_blank" title="CSDN">
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons">
            </a>
          </div>
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Android-Dex文件"><span class="nav-text">一、Android Dex文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-整体结构"><span class="nav-text">1.1 整体结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-详细描述"><span class="nav-text">1.2 详细描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-用010editor查看dex文件"><span class="nav-text">1.3 用010editor查看dex文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-Android-Odex，Oat，Vdex-art文件"><span class="nav-text">二. Android Odex，Oat，Vdex , art文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-odex文件概述（-5-0之前-）"><span class="nav-text">2.1 odex文件概述（ 5.0之前 ）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-oat文件（5-0及5-0之后）"><span class="nav-text">2.2. oat文件（5.0及5.0之后）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-oat文件概述"><span class="nav-text">2.2.1 oat文件概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-readelf-查看oat文件结构"><span class="nav-text">2.2.2 readelf 查看oat文件结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-oat文件结构大致如图"><span class="nav-text">2.2.3 oat文件结构大致如图</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-art文件"><span class="nav-text">2.3. art文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-vdex文件"><span class="nav-text">2.4. vdex文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-总结"><span class="nav-text">三. 总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-工具使用"><span class="nav-text">四.工具使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-dx-和-dexdump工具"><span class="nav-text">4.1.dx 和 dexdump工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-oatdump工具"><span class="nav-text">4.2. oatdump工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-objdump工具"><span class="nav-text">4.3.objdump工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Vdex-Extractor工具"><span class="nav-text">4.4. Vdex Extractor工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2019 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Skytoby</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme Next
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'https-zproo-github-io';
      var disqus_identifier = '2019/Android dex，odex，oat，vdex，art文件结构/';
      var disqus_title = "Android dex，odex，oat，vdex，art文件结构";
      var disqus_url = 'http://zproo.github.io/2019/Android dex，odex，oat，vdex，art文件结构/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  









  
  

  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
